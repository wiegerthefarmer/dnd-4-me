:root {
  --bg: #161b22;
  --bg-alt: #1f2630;
  --panel: #242c37;
  --border: #2f3a46;
  --accent: #ffb347;
  --accent-fg: #111;
  --text: #e6edf3;
  --danger: #d9534f;
  --focus: #61afef;
  --radius: 6px;
  font-size: 15px;
}

* { box-sizing: border-box; }
body {
  margin: 0;
  font-family: system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Ubuntu,"Helvetica Neue",Arial,sans-serif;
  background: var(--bg);
  color: var(--text);
  line-height: 1.3;
  -webkit-font-smoothing: antialiased;
}
h1,h2,h3 { margin: .2em 0 .5em; font-weight: 600; }
h1 { font-size: 1.6rem; }
h2 { font-size: 1.1rem; letter-spacing:.5px; text-transform:uppercase; }

header {
  background: linear-gradient(135deg,#2c3642,#1e242c);
  padding: .75rem 1rem 1rem;
  border-bottom: 2px solid var(--border);
  position: sticky;
  top: 0;
  z-index: 20;
}

.top-bar {
  display: flex;
  gap: 1rem;
  flex-wrap: wrap;
  align-items: center;
  justify-content: space-between;
}

.char-switcher select {
  background: var(--panel);
  border: 1px solid var(--border);
  padding: .4rem .6rem;
  color: var(--text);
  border-radius: var(--radius);
  font-size: .95rem;
  min-width: 180px;
}

button, .import-label {
  background: var(--accent);
  color: var(--accent-fg);
  border: none;
  padding: .5rem .75rem;
  font-size: .8rem;
  font-weight: 600;
  border-radius: var(--radius);
  cursor: pointer;
  letter-spacing: .5px;
  display: inline-flex;
  gap: .3rem;
  align-items: center;
}
button:hover, .import-label:hover { filter: brightness(1.08); }
button.danger, .danger { background: var(--danger); color:#fff; }
button.danger:hover { filter: brightness(1.1); }

#importFile { display:none; }
.import-label {
  border: 1px solid transparent;
}

main {
  padding: 1rem;
  display: grid;
  grid-template-columns: repeat(auto-fit,minmax(340px,1fr));
  gap: 1rem;
  max-width: 1800px;
  margin: 0 auto;
}

.panel {
  background: var(--panel);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: .85rem .9rem 1rem;
  display: flex;
  flex-direction: column;
  gap: .65rem;
  position: relative;
}

.grid {
  display: grid;
}
.two-col { grid-template-columns: repeat(auto-fit,minmax(160px,1fr)); }
.three-col { grid-template-columns: repeat(auto-fit,minmax(150px,1fr)); }
.gap { gap: .6rem .8rem; }

label {
  display: flex;
  flex-direction: column;
  font-size: .7rem;
  text-transform: uppercase;
  letter-spacing: .8px;
  gap: .25rem;
  font-weight: 600;
  color: #b9c4ce;
}
label input, label textarea, select {
  font: inherit;
  background: #151a21;
  color: var(--text);
  border: 1px solid var(--border);
  padding: .5rem .55rem;
  border-radius: 4px;
  resize: vertical;
  font-size: .85rem;
  font-weight: 500;
  letter-spacing: 0;
}
textarea { line-height: 1.25; }
label input:focus, label textarea:focus, select:focus {
  outline: 2px solid var(--focus);
  outline-offset: 0;
  border-color: var(--focus);
}

.level-proficiency {
  display:flex;
  flex-wrap:wrap;
  gap:1rem 2rem;
  align-items:center;
}
.level-proficiency > * { min-width: 100px; }
.level-proficiency .label { font-size:.65rem; text-transform:uppercase; letter-spacing:.8px; color:#9fb2c2; }
.level-proficiency .value { font-size:1.1rem; font-weight:700; color: var(--accent); }

.abilities-grid {
  display:grid;
  grid-template-columns: repeat(auto-fit,minmax(90px,1fr));
  gap:.6rem;
}
.ability-box {
  background:#151b22;
  border:1px solid var(--border);
  border-radius: var(--radius);
  padding:.35rem .4rem .5rem;
  display:flex;
  flex-direction:column;
  gap:.25rem;
  position:relative;
}
.ability-box h3 {
  font-size:.65rem;
  letter-spacing:1px;
  margin:0;
  text-align:center;
  text-transform:uppercase;
  color:#a8b8c4;
}
.ability-box input {
  text-align:center;
  font-size:.95rem;
  padding:.35rem .4rem;
}
.ability-mod {
  text-align:center;
  font-weight:700;
  font-size:1.05rem;
  background:#0f1419;
  padding:.25rem .4rem;
  border-radius:4px;
  border:1px solid #222c35;
  color: var(--accent);
}

.saves-and-skills {
  display:grid;
  grid-template-columns: 1fr;
  gap:1rem;
}
@media (min-width:1050px){
  .saves-and-skills { grid-template-columns: 220px 1fr; }
}

.subpanel {
  background:#151b21;
  border:1px solid var(--border);
  border-radius: var(--radius);
  padding:.6rem .7rem .7rem;
  display:flex;
  flex-direction:column;
  gap:.4rem;
}

.saving-throws, .skills-list {
  display:flex;
  flex-direction:column;
  gap:.25rem;
  font-size:.75rem;
}

.save-row, .skill-row {
  display:flex;
  align-items:center;
  gap:.4rem;
  background:#10161c;
  border:1px solid #202a33;
  padding:.3rem .4rem;
  border-radius:4px;
}

.save-row input.save-prof,
.skill-row input.skill-prof,
.skill-row input.skill-exp {
  width:1rem;
  height:1rem;
  margin:0;
  accent-color: var(--accent);
  cursor:pointer;
}

.skill-row .skill-name {
  flex:1;
}
.save-row .save-name {
  flex:1;
}

.value-pill {
  background:#1e2730;
  padding:.15rem .5rem;
  border-radius:999px;
  font-weight:600;
  min-width:34px;
  text-align:center;
  font-size:.7rem;
  border:1px solid #27313b;
  color: var(--accent);
}

.skill-origin {
  font-size:.55rem;
  color:#8594a1;
  letter-spacing:.5px;
  background:#0d1217;
  padding:.1rem .35rem;
  border-radius:4px;
  border:1px solid #1c252e;
  text-transform:uppercase;
}

.skills-legend {
  font-size:.6rem;
  color:#97a6b3;
  text-align:right;
}

.passive-row {
  margin-top:.4rem;
  font-size:.75rem;
  font-weight:600;
  padding:.4rem .5rem;
  background:#10161c;
  border:1px solid #202a33;
  border-radius:4px;
  display:flex;
  justify-content:space-between;
}

.combat .stat-display {
  display:flex;
  flex-direction:column;
  background:#151a21;
  border:1px solid var(--border);
  padding:.4rem .5rem;
  border-radius:4px;
  gap:.2rem;
}
.stat-display .label {
  font-size:.55rem;
  letter-spacing:.8px;
  text-transform:uppercase;
  color:#a6b3bf;
}
.stat-display span#initiativeTotal {
  font-size:1.1rem;
  font-weight:700;
  color: var(--accent);
}

.death-saves {
  display:flex;
  flex-wrap:wrap;
  gap:.75rem;
  background:#151a21;
  border:1px solid var(--border);
  padding:.6rem .8rem .8rem;
  border-radius: var(--radius);
  font-size:.7rem;
  letter-spacing:.5px;
  text-transform:uppercase;
}
.death-saves div {
  display:flex;
  gap:.35rem;
  align-items:center;
}
.death-saves input {
  width:1rem;
  height:1rem;
  margin:0;
  accent-color: var(--accent);
  cursor:pointer;
}

.equipment textarea,
.features textarea,
.notes textarea {
  min-height: 140px;
  font-size:.8rem;
}

.attacks-list {
  display:flex;
  flex-direction:column;
  gap:.5rem;
}
.attack-row {
  display:grid;
  grid-template-columns: repeat(auto-fit,minmax(110px,1fr)) 40px;
  gap:.4rem;
  background:#151a21;
  border:1px solid var(--border);
  padding:.5rem;
  border-radius: var(--radius);
  align-items:end;
}
.attack-row label {
  font-size:.55rem;
}
.attack-row button.remove-attack {
  background: var(--danger);
  font-size:.7rem;
  height:30px;
  align-self:center;
  padding:.3rem;
}

.spell-slots {
  display:grid;
  grid-template-columns: repeat(auto-fill,minmax(80px,1fr));
  gap:.4rem;
}
.slot-box {
  background:#151a21;
  border:1px solid var(--border);
  padding:.4rem .45rem .55rem;
  border-radius: var(--radius);
  display:flex;
  flex-direction:column;
  gap:.3rem;
  font-size:.65rem;
  text-transform:uppercase;
  letter-spacing:.5px;
}
.slot-box input {
  font-size:.75rem;
  text-align:center;
  padding:.25rem;
}
.slot-box .slot-level {
  font-weight:600;
  color:#9fb2c2;
}
.slot-box .slot-remaining {
  font-size:.7rem;
  font-weight:600;
  color: var(--accent);
}

footer {
  text-align:center;
  padding:1.5rem .5rem 2rem;
  font-size:.65rem;
  color:#6e7a85;
}

.sr-only {
  position:absolute;
  width:1px;height:1px;
  padding:0;margin:-1px;
  overflow:hidden;
  clip:rect(0 0 0 0);

}

/* Badges for skills/expertise */
.skill-badges {
  display:inline-flex;
  gap:0.5rem;
  align-items:center;
  margin-left:0.6rem;
}
.badge {
  background: rgba(255,179,71,0.12);
  color: var(--accent);
  border: 1px solid rgba(255,179,71,0.18);
  padding: .18rem .45rem;
  border-radius: 999px;
  font-weight:700;
  font-size:.65rem;
}
.badge[title] { cursor: help; }

/* Lock icon for class-granted saves */
.save-lock {
  width:14px; height:14px; display:inline-block; margin-left:6px; opacity:0.9;
  background: linear-gradient(180deg, rgba(255,179,71,0.12), rgba(255,179,71,0.06));
  border-radius:3px; border:1px solid rgba(255,179,71,0.12);
  text-align:center; font-size:11px; color:var(--accent); line-height:14px; font-weight:800;
}
.import-label input#allowClassOverride { margin-right:.4rem; }


::-webkit-scrollbar {
  width: 10px;
}
::-webkit-scrollbar-track {
  background: #12171d;
}
::-webkit-scrollbar-thumb {
  background: #27313b;
  border-radius: 5px;
}
::-webkit-scrollbar-thumb:hover {
  background: #34414d;
}

@media (max-width:700px) {
  header h1 { font-size:1.25rem; }
  button { font-size:.7rem; }
  label input, label textarea { font-size:.8rem; }
}

/* Tutorial modal */
.modal {
  position: fixed;
  left: 50%;
  bottom: 18px;
  transform: translateX(-50%) translateY(12px);
  display: none;
  z-index: 60;
  pointer-events: auto;
  width: 100%;
  max-width: 960px;
}
.modal[aria-hidden="false"] {
  display: block;
  opacity: 1;
  transform: translateX(-50%) translateY(0);
  transition: transform 260ms ease, opacity 260ms ease;
}
.modal-content {
  background: linear-gradient(180deg, rgba(36,44,55,0.98), rgba(36,44,55,0.98));
  border: 1px solid var(--border);
  padding: .9rem 1rem;
  width: min(720px, 96%);
  border-radius: 10px;
  color: var(--text);
  box-shadow: 0 12px 40px rgba(0,0,0,0.6);
  max-height: 48vh;
  overflow: auto;
}
.modal-controls { display:flex; gap:.5rem; justify-content:flex-end; margin-top:1rem; }
.modal-controls button { background:var(--accent); color:var(--accent-fg); }

/* Highlight used by tutorial to draw attention */
.tutorial-highlight {
  box-shadow: 0 0 0 3px rgba(97,175,239,0.12), 0 6px 18px rgba(0,0,0,0.45) inset;
  transition: box-shadow 280ms ease-in-out, transform 180ms ease-in-out;
  transform: translateZ(0);
  animation: tutorial-pulse 1800ms ease-in-out infinite;
  will-change: box-shadow, transform;
}

@keyframes tutorial-pulse {
  0% {
    box-shadow: 0 0 0 3px rgba(97,175,239,0.06), 0 6px 18px rgba(0,0,0,0.45) inset;
    transform: translateZ(0) scale(1);
  }
  50% {
    box-shadow: 0 0 0 8px rgba(97,175,239,0.12), 0 8px 24px rgba(0,0,0,0.5) inset;
    transform: translateZ(0) scale(1.01);
  }
  100% {
    box-shadow: 0 0 0 3px rgba(97,175,239,0.06), 0 6px 18px rgba(0,0,0,0.45) inset;
    transform: translateZ(0) scale(1);
  }
}